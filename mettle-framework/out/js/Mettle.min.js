/*!
 * Copyright 2014 Manish Shanker
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/*!
 * @author Manish Shanker
 * @buildTimestamp 12042014074040
 */
(function(b,a){a.Mettle=b||{};
a.Mettle_Template_LOAD_BY_URL_DEFAULT_PATH=a.Mettle_Template_LOAD_BY_URL_DEFAULT_PATH||"";a.Mettle_Template_LOAD_BY_URL_DEFAULT_EXTENSION=a.Mettle_Template_LOAD_BY_URL_DEFAULT_EXTENSION||".hbs";a.Mettle_moduleLevelMessaging=true;}(window.Mettle,window));(function(d,c){function a(e){return new b(c(e));
}a.get=function(){return c.get.apply(this,arguments);};a.grep=function(){return c.grep.apply(this,arguments);};var b=function(e){this.$item=e;};b.prototype={on:function(){this.$item.on.apply(this.$item,arguments);return this;},trigger:function(){this.$item.trigger.apply(this.$item,arguments);return this;
},off:function(){this.$item.off.apply(this.$item,arguments);return this;},html:function(e){if(e){this.$item.html(e);return this;}return this.$item.html();},attr:function(e,f){if(f){this.$item.attr(e,f);return this;}return this.$item.attr(e);},each:function(){this.$item.each.apply(this.$item,arguments);
return this;},addClass:function(e){this.$item.addClass(e);return this;},removeClass:function(e){this.$item.removeClass(e);return this;},empty:function(){this.$item.empty();return this;},remove:function(){this.$item.remove();},append:function(e){this.$item.append(e);}};d.DOM=a;}(Mettle,(window.Zepto||window.jQuery)));
(function(c,b){var a={};c.init=function(f,e,d){c.i18nT=e;c.ModuleNameSpace=f||{};c.LOG_LEVEL.CURRENT=d||c.LOG_LEVEL.WARN;return c;};c.modules=function(d){c.each(d,function(f,e){a[e]=new f();a[e].load();});return c;};c.managedModules=function(d){var f={};var e={};c.each(d,function(i,h){var g=b("#"+h);
g.attr("data-keep-state","false");var j=new i();f[h]=f[h]||g.html();a[h]=j;c.messageBus.subscribe(j.controlMessages.hide,function(){c.logInfo("destroying module:"+h);j.destroy();g.empty();a[h]=null;delete a[h];j=null;e[h]=true;});c.messageBus.subscribe(j.controlMessages.show,function(k){if(e[h]){c.logInfo("loading destroyed module:"+h);
g.html(f[h]);j=new i();a[h]=j;}else{c.logInfo("loading module:"+h);}j.load();j.show(k);e[h]=false;});});return c;};c.getModule=function(d){return a[d];};c.start=function(d){c.navigation.load(d);return c;};}(Mettle,Mettle.DOM));(function(){var b=function(){};var a=function(c){return typeof c==="function";
};b.extend=function(f){var c=function(i){if(i!==a&&a(this.init)){this.init.apply(this,arguments);}};c.prototype=new this(a);var h=function(i,j){return function(){this._super=j;return i.apply(this,arguments);};};var d;for(d in f){if(f.hasOwnProperty(d)){var e=f[d],g=c.prototype[d];c.prototype[d]=!a(e)||!a(g)?e:h(e,g);
}}c.prototype.constructor=c;c.extend=this.extend;return c;};window.Class=b;}());(function(f){f.noop=d;f.each=e;f.currentLocation=function(){return location.href;};f.LOG_LEVEL={ERROR:1,WARN:2,INFO:4,LOG:8,ALL:16,OFF:-1,CURRENT:1};function a(g){return(window.console&&window.console.log&&function(){if(f.LOG_LEVEL.CURRENT>=f.LOG_LEVEL[g.toUpperCase()]){if(console.log.apply){(console[g]?console[g]:console.log).apply(console,arguments);
}else{(console[g]?console[g]:console.log)(arguments);}}})||f.noop;}f.logInfo=a("info");f.log=a("log");f.logError=a("error");f.logWarn=a("warn");function e(g,h){if(g){if(g instanceof Array){c(g,h);}else{b(g,h);}}}function b(g,i){var h;if(g){for(h in g){if(g.hasOwnProperty(h)){i(g[h],h);}}}}function c(j,k){var h,g;
if(j){for(h=0,g=j.length;h<g;h++){k(j[h],h);}}}function d(){}}(Mettle));(function(f,e){var d=function(){this.guid=c();this.localMessageBus=e({});f.logInfo("messageBus._____create",this.guid);};d.prototype={publish:function(g,h){f.logInfo("messageBus.____publish",this.guid,g,h);this.localMessageBus.trigger(g,[h]);
},subscribe:function(i,g,h){if(typeof i==="string"){h=g;g=i;i=window;}f.logInfo("messageBus.__subscribe",this.guid,g);var j=this;if(typeof g==="string"){return a(j,h,i,g);}if(arguments.length===1){g=i;}var k={};f.each(g,function(m,l){k[l]=a(j,m,i,l);});return k;},unsubscribe:function(g,h){f.logInfo("messageBus.unsubscribe",this.guid,g);
var i=this;if(typeof g==="string"){i.localMessageBus.off(g,h);}else{f.each(g,function(k,j){i.localMessageBus.off(j,k);});}}};function a(g,k,j,i){var h=function(m,l){f.logInfo("messageBus.___received",i,l);k.call(j,l);};g.localMessageBus.on(i,h);return h;}function c(){return b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b();
}function b(){return Math.floor((1+Math.random())*65536).toString(16).substring(1);}f.messageBus=new d();f.Messaging=d;}(Mettle,Mettle.DOM));(function(c){c.Base=Class.extend({messageBus:c.messageBus,injector:null,guid:null,init:function(){this.guid=b();},injectDependencies:function(d){c.dependencyInjector(this,d);
}});function b(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a();}function a(){return Math.floor((1+Math.random())*65536).toString(16).substring(1);}}(Mettle));(function(l){l.Controller=l.Base.extend({autoWire:false,autoDestroy:false,autoShowHide:false,autoLoadControls:false,autoLayout:false,messages:null,injectLocalMessageBus:false,inject:null,routes:{},serviceUpdate:{},messageBus:l.messageBus,localMessageBus:null,init:function(u){this.injectDependencies(u);
},views:null,templates:null,controls:null,services:null,shownAndLoaded:false,layoutChange:function(){if(this.autoLayout){r(this.controls,"layoutChange");r(this.views,"layoutChange");}},load:function(){m(this);b(this);},loadOnce:function(){if(!this._loaded){this.load();this._loaded=true;}},unload:function(){j(this);
f(this);},update:function(u){d(this,u);},onUpdateReceive:function(v,u){g(this,v,u);},destroy:function(){s(this);},onRouteChange:function(){return this.routes;},onServiceUpdate:function(){return this.serviceUpdate;},hide:function(u){o(this);if(!(u&&u.keepPreviousState)){e(this,false,arguments);n(this);
}},show:function(u){if(!this.shownAndLoaded){k(this,arguments);this.shownAndLoaded=true;}else{if(u&&u.keepPreviousState){p(this);}else{a(this,arguments);}}}});function k(u,v){e(u,true,v);i(u);}function a(u,v){e(u,true,v);p(u);}function f(u){r(u.controls,"unload");}function b(u){if(u.autoLoadControls){r(u.controls,"load");
}}function i(u){if(!u._exist&&u.autoWire){t(u.services,u);}u._exist=true;}function n(u){if(u.autoDestroy){u.destroy();}}function p(u){if(u.autoWire){r(u.services,"start");}}function o(u){if(u.autoWire){r(u.services,"stop");}}function g(u,w,v){u.controls[v].update(w);if(u.lastStateData&&u.onServiceUpdate()[v]){u.onServiceUpdate()[v].call(u,u.controls[v],u.lastStateData);
}}function d(u,v){if(u.autoWire){q(u,v);}}function s(u){h(u);j(u);r(u.views,"destroy");r(u.controls,"destroy");r(u.services,"destroy");r(u.templates,"destroy");u.services=null;u.views=null;u.lastStateData=null;u.templates=null;u.options=null;u.controls=null;u._exist=false;u._loaded=false;u.shownAndLoaded=false;
}function h(u){if(u._controlMessagesFn){var w=u.controlMessages;var v=u._controlMessagesFn;l.each(["show","hide","stateChange"],function(x){l.messageBus.unsubscribe(w[x],v[x]);});}}function j(u){if(u._messagesFn){l.each(u.messages,function(w,v){l.messageBus.unsubscribe(w,u._messagesFn(v));});}}function q(u,v){l.each(u.templates,function(x,w){x.load(function(){if(u.views[w]){u.views[w].render(x.process(v));
}});});}function r(v,w,u){u=u||[];l.each(v,function(x){x[w].apply(x,u);});}function t(u,v){l.each(u,function(w,x){w.onUpdate(c(v,x));w.fetch();});}function c(v,u){return function(w){v.onUpdateReceive(w,u);};}function m(u){if(!(u.messages||u.controlMessages)){return;}h(u);var v=u.controlMessages;u._controlMessagesFn={};
u._controlMessagesFn.show=l.messageBus.subscribe(u,v.show,u.show);u._controlMessagesFn.hide=l.messageBus.subscribe(u,v.hide,u.hide);u._controlMessagesFn.stateChange=l.messageBus.subscribe(u,v.stateChange,function(w){u.lastStateData=w;l.each(u.onRouteChange(w),function(y,x){l.navigation.route(u,x,y);});
});j(u);u._messagesFn={};l.each(u.messages,function(x,w){u._messagesFn[w]=l.messageBus.subscribe(u,w,x);});}function e(w,u,v){if(w.autoShowHide){r(w.views,u?"show":"hide",v);r(w.controls,u?"show":"hide",v);}}}(Mettle));(function(c,b){var a={};c.Service=c.Base.extend({dataURL:null,init:function(){this._super();
a[this.guid]={};a[this.guid].updateCallBack=[];},fetch:function(){b.get(this.dataURL,function(d){this.updated(d);});},update:c.noop,get:c.noop,lastResult:function(){return a[this.guid].lastResult;},onUpdate:function(d){a[this.guid].updateCallBack.push(d);},updated:function(f){var g,e;var d=a[this.guid];
d.lastResult=f;if(d){for(g=0,e=d.updateCallBack.length;g<e;g++){d.updateCallBack[g](f);}}},destroy:function(){delete a[this.guid];},stop:c.noop,start:c.noop});}(Mettle,Mettle.DOM));(function(c,b){var a={};c.TemplateByString=function(f){return new c.Template(f,c.Template.LOAD.BY_STRING);};c.TemplateByID=function(f){return new c.Template(f,c.Template.LOAD.BY_ID);
};c.TemplateByURL=function(f){return new c.Template(f,c.Template.LOAD.BY_URL);};c.TemplateSafeString=function(f){return new c.templateEngine.safeString(f);};c.Template=c.Base.extend({init:function(f,g){this._super();this.path=f;this.loadBy=g||c.Template.LOAD.DEFAULT;},process:function(f){if(this.path===undefined){return"";
}if(!a[this.guid]){console.log("Template param: ",this.path,this.loadBy);throw new Error("Template not in cache!!");}return c.templateEngine.process(a[this.guid],f);},load:function(h){var f=this;if(f.path===undefined||a[f.guid]){h.call(f,f);}else{if(f.loadBy===c.Template.LOAD.BY_URL){var g=e(d(c.Template.LOAD.BY_URL_DEFAULT_PATH)+f.path);
c.templateEngine.getByURL(g,function(i){a[f.guid]=i;h.call(f,f);});}else{if(this.loadBy===c.Template.LOAD.BY_ID){a[this.guid]=c.templateEngine.getById(this.path);c.templateEngine.remove(this.path);setTimeout(function(){h.call(f,f);},5);}else{a[this.guid]=c.templateEngine.getByString(this.path);setTimeout(function(){h.call(f,f);
},5);}}}},destroy:function(){delete a[this.guid];}});function e(f){return f+(/\.[a-z]{3,4}$/.test(f)?"":c.Template.LOAD.BY_URL_DEFAULT_EXTENSION);}function d(f){return f+(/\/$/.test(f)?"":"/");}c.Template.LOAD={BY_ID:"APP_TEMPLATE_BY_ID",BY_URL:"APP_TEMPLATE_BY_URL",BY_STRING:"APP_TEMPLATE_BY_STRING",DEFAULT:"APP_TEMPLATE_BY_ID",BY_URL_DEFAULT_PATH:b.Mettle_Template_LOAD_BY_URL_DEFAULT_PATH||"",BY_URL_DEFAULT_EXTENSION:b.Mettle_Template_LOAD_BY_URL_DEFAULT_EXTENSION||".hbs"};
}(Mettle,window));(function(j,b){j.View=j.Base.extend({autoManageEventBind:false,autoLayout:false,appendViewTo:null,init:function(l){this._super();this.injectDependencies(l);if(!this.appendViewTo){i.call(this);}},container:null,$container:null,bindings:null,layoutChange:j.noop,bind:function(){c(this,false);
},unbind:function(){c(this,true);},$el:null,render:function(l){if(this.appendViewTo){b(this.appendViewTo===true?"body":this.appendViewTo).append(l);i.call(this);}else{this.$container.html(l);}},destroy:function(){var l=this;a(l);l.unbind();l.$container.empty();},hide:function(){var l=this;l.$el.removeClass("show").addClass("hide");
h(l);a(l);},show:function(){var l=this;l.$el.removeClass("hide").addClass("show");e(l);k(l);}});function i(){this.$container=b(this.container);this.$el=this.$container.$item;if(!this.autoManageEventBind){this.bind();}k(this);}function f(l){return typeof l.bindings==="function"?l.bindings():l.bindings;
}function c(l,m){var o=f(l);var n=m?d:g;j.each(o,function(q,p){var r=/([a-zA-Z]+)\s([a-zA-Z0-9\-\.\(\)>]+)/.exec(p);n(r,l.$container,p,l,q);});}function g(p,o,m,l,n){if(p){o.on(p[1],p[2],function(q){return n.call(l,q,this);});}else{o.on(m,function(q){return n.call(l,q,this);});}}function d(m,n,l){if(m){n.off(m[1],m[2]);
}else{n.off(l);}}function k(l){if(l.autoLayout){b(window).off("resize."+l.guid).on(("resize."+l.guid),function(){l.layoutChange();});}}function a(l){if(l.autoLayout){b(window).off("resize."+l.guid);}}function h(l){if(l.autoManageEventBind){l.unbind();}}function e(l){if(l.autoManageEventBind){l.bind();
}}}(Mettle,Mettle.DOM));(function(l){var g={"tmpl!":function(o,p){return l.TemplateByURL(p);}};l.dependencyInjector=c;l.dependencyInjector.define=function(p,o){g[p]=o;};l.dependencyInjector.define("controller!",function(o,p){return new l.ModuleNameSpace.controller[p](o.injectLocalMessageBus?o.localMessageBus:o.messageBus);
});l.dependencyInjector.define("template!",function(o,p){return new l.ModuleNameSpace.template[p](o.injectLocalMessageBus?o.localMessageBus:o.messageBus);});l.dependencyInjector.define("service!",function(o,p){return new l.ModuleNameSpace.service[p](o.injectLocalMessageBus?o.localMessageBus:o.messageBus);
});l.dependencyInjector.define("view!",function(o,p){return new l.ModuleNameSpace.view[p](o.injectLocalMessageBus?o.localMessageBus:o.messageBus);});var e={"views":"view","templates":"template","services":"service","controls":"controller"};function c(o,p){if(window.Mettle_moduleLevelMessaging){if(l.Messaging&&(p instanceof l.Messaging)){o.messageBus=p;
}if(o.injectLocalMessageBus){o.localMessageBus=(p&&p.inject&&p.inject.localMessageBus)||new l.Messaging();}}else{o.messageBus=new l.Messaging();}var q=(p&&p.inject)||(o.inject&&(b(o.inject)?o.inject():o.inject));q=k(q);l.each(q,function(r,s){var t=/^controls$|^templates$|^views$|^services$/.exec(s);if(t){if(r instanceof Array){h(r,o,s);
}else{if(b(r)){o[s]=r.call(o,o);}else{l.each(r,function(v,u){o[s]=o[s]||{};o[s][u]=o[s][u]={};j(o[s],u,f(v,o,s));});}}}else{o[s]=f(r,o,s);}});}function h(p,o,q){l.each(p,function(r){o[q]=o[q]||{};if(a(r)){o[q][r]=o[r]||{};j(o[q],r,m(o,q,r));}else{l.each(r,function(t,s){j(o[q],s,f(t,o,q));});}});}function f(p,o,q){return a(p)?m(o,q,p):(b(p)?p():p);
}function j(o,p,q){o[p]=q;}function m(o,q,p){if(o.injector){l.ModuleNameSpace.dependency=l.ModuleNameSpace.dependency||{};var r=l.ModuleNameSpace.dependency[o.injector];if(r){if(r[q][p]){return r[q][p](o);}}}return i(o,q,p);}function n(o){return o.substr(0,1).toUpperCase()+o.substr(1);}function i(o,q,p){if(p.indexOf(".")>0){try{return d(p,o.injectLocalMessageBus?o.localMessageBus:o.messageBus);
}catch(t){l.logError(t);throw new Error("Direct dependency instance creation error: ("+q+","+p+" | "+(n(p))+")");}}if(p.indexOf("!")>0){try{var s=/([\w\W]+?!)([\w\W]*)/.exec(p);return g[s[1]](o,s[2]);}catch(t){l.logError(t);throw new Error("Defined dependency instance creation error: ("+q+","+p+" | "+(n(p))+")");
}}var r=e[q];l.ModuleNameSpace[r]=l.ModuleNameSpace[r]||{};if(q==="templates"){if(l.ModuleNameSpace.template[n(p)]){return new l.ModuleNameSpace.template[n(p)]();}if(l.ModuleNameSpace.template[p]){return l.ModuleNameSpace.template[p];}return l.TemplateByID("tmpl"+n(p));}try{return new l.ModuleNameSpace[r][n(p)](o.injectLocalMessageBus?o.localMessageBus:o.messageBus);
}catch(t){l.logError(t);throw new Error("Dependency instance creation error: ("+q+","+p+" | "+r+"."+(n(p))+")");}}function d(o,q){var p=window;l.each(o.split("."),function(r){p=p[r];});return new p(q);}function k(s){if(a(s)){var r={};var q=s.split(":");var p=q[1];var o=q[0];l.each({"templates":/T/,"views":/V/,"services":/S/},function(u,t){if(u.test(o)){r[t]=[p];
}});s=r;}return s;}function b(o){return typeof o==="function";}function a(o){return typeof o==="string";}}(Mettle));(function(a){a.registerHelper("list",function(d,j,f){var e,h,b,g="",c="";if(typeof j==="string"){g=" class='"+j+"' ";c=" class='"+j+"-item' ";}else{f=j;}e="<ul"+g+">";if(d&&d.length){for(h=0,b=d.length;
h<b;h++){e+="<li"+c+">"+f.fn(d[h])+"</li>";}}return e+"</ul>";});}(Handlebars));(function(a){Handlebars.registerHelper("i18n",function(b,c){c=typeof c==="object"?null:c;return new Handlebars.SafeString(a.i18n(b,c));});}(Mettle));(function(a){a.i18n=function(d,c){if(!a.i18nT){throw new Error("No resource bundle included for i18n!!");
}if(d===null){return"";}var b;if(c){b=c;}else{b=d.toLowerCase().replace(/ ([a-z])/g,function(e,f){return f.toUpperCase();}).replace(/ /g,"");b=b.charAt(0).toLowerCase()+b.substring(1);}return a.i18nT[b]||"!!!"+d+"!!!";};}(Mettle));(function(f,e){var g;var b;var d={};var a="#/home";var c=function(){function o(t){a=t;
e(window).on("hashchange",p);if(location.hash){p();}else{location.href="#/"+a;}}function p(){b=location.hash;var v=false;var u=m(b);if(!u){location.href="#/"+a;return;}if(u.page!==g){h(g,u);g=u.page;v=k(g,u);if(v){return;}}var t=m(location.hash);g=t.page;if(!l(g)||q(t)){j(t);d[g]=u;}}function q(t){return(!d[g]||(t.pageData!==d[t.page].pageData));
}function j(t){f.messageBus.publish("navigationStateChange:"+g,t);f.messageBus.publish("navigationStateChange",t);}function h(u,t){if(u){e("a[href$='#/"+u+"']").removeClass("selected");e("#"+u).removeClass("page-visible");f.messageBus.publish("navigationChangedFrom:"+u,t);}}function k(x,v){e("#"+x).addClass("page-visible");
var u=r(x);u.addClass("selected");var w=d[x];var t=false;if(w&&(w.pageData!==v.pageData)){if(w.pageData){f.logInfo("redirecting to restore state of "+g);location.replace("#/"+x+"/"+w.pageData);t=true;}}f.messageBus.publish("navigationChangedTo:"+g,v);return t;}function l(u){var t=s(u).attr("data-keep-state");
return !(t===false||t==="false");}function s(t){return e("#"+t);}function r(t){return e("a[href$='#/"+t+"']");}function m(u){var t=/#\/([a-zA-Z0-9_\$\-]+)(\/([\w\W]+))?/.exec(u);if(!t){return null;}return{path:u,page:t[1],pageData:t[3],keepPreviousState:l(t[1])};}function i(t){b=t;location.hash=t;if(window.hasOwnProperty("onhashchange")){p();
}}function n(v,w,x,t){var u=new RegExp(("^"+w+"$").replace("?",".").replace(/:[a-zA-Z0-9-_]+/g,function(y){return"([a-zA-Z0-9-_]+)";})).exec(b.substring(1).replace(/[\/]?$/,""));if(u){u.splice(0,1);x.apply(v,u);}else{if(t){t.call(v);}}}return{load:o,route:n,setRoute:i};};f.navigation=new c();}(Mettle,Mettle.DOM));
(function(i,e){i.templateEngine={getById:j,getByCSSSelector:g,getByURL:b,getByString:c,process:a,safeString:d,remove:f};function b(k,l){e.get(k,function(m){l(h(m));});}function d(k){return new Handlebars.SafeString(k);}function h(k){return Handlebars.compile(k);}function f(l){var k=e("#"+l);k.remove();
}function c(k){return h(k);}function j(m){var k=e("#"+m);var l=k.html();k.remove();if(!l){throw new Error("Template id: "+m+", not found!!");}else{return h(l);}}function g(l){var k=e(l).html();if(!k){throw new Error("Template selector: "+l+", not matched any!!");}else{return h(k);}}function a(l,k){return l(k);
}}(Mettle,Mettle.DOM));